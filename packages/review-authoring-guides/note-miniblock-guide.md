# ノート・ミニブロック機能ガイド

Re:VIEW Extensions におけるノート（`//note`）と7種類のミニブロックの使用方法を解説します。

## 概要

ノートとミニブロックは、本文とは別に読者の注意を引く情報を提示するための機能です。

- **ノート**: ラベル付与・参照が可能な汎用的な注記ブロック
- **ミニブロック**: 特定の用途に特化した7種類の注記ブロック

## ノートブロック（`//note`）

### 基本構文

```review
//note[<ラベル>][<タイトル>]{
  本文
//}
```

### 引数ルール

⚠️ **重要**: 第1引数のみ指定した場合は**タイトル**として解釈されます（ラベルではありません）

| パターン | 解釈 | 参照可否 |
|---------|------|----------|
| `//note[作業メモ]{...}` | タイトル="作業メモ"、ラベルなし | ❌ |
| `//note[note1][作業メモ]{...}` | ラベル="note1"、タイトル="作業メモ" | ✅ |
| `//note[][作業メモ]{...}` | ラベルなし、タイトル="作業メモ" | ❌ |
| `//note{...}` | ラベルなし、タイトルなし | ❌ |

### 参照マクロ

```review
本文から @<note>{note1} を参照できます。
```

### 使用例

```review
//note[deploy-note][デプロイ手順]{
以下の順序でデプロイを実行してください：

* データベースのマイグレーション
* アプリケーションのデプロイ
* ヘルスチェックの確認

//list[][確認コマンド]{
curl https://api.example.com/health
//}
//}

詳細は @<note>{deploy-note} を参照してください。
```

### ノート内で使用可能な要素

- 箇条書き（`*`、`1.`）
- プログラムリスト（`//list`）
- ターミナル（`//terminal`）
- 脚注（`@<fn>{...}` + `//footnote`）

## ミニブロック

### 7種類のミニブロック

| 種類 | 用途 | アイコン | CSSクラス |
|------|------|----------|-----------|
| `//memo` | 開発メモ・備忘録 | 📝 | `rs-memo` |
| `//tip` | ヒント・コツ | 💡 | `rs-tip` |
| `//info` | 情報・説明 | ℹ️ | `rs-info` |
| `//warning` | 警告・注意喚起 | ⚠️ | `rs-warning` |
| `//important` | 重要事項 | ❗ | `rs-important` |
| `//caution` | 要注意・慎重な操作 | ⚡ | `rs-caution` |
| `//notice` | お知らせ・通知 | 📢 | `rs-notice` |

### 基本構文

```review
//<種類>[<タイトル>]{
  本文
//}
```

### 使用例

#### Memo（メモ）
```review
//memo[API変更履歴]{
v2.0: エンドポイントを /api/v2 に変更
v1.0: 初回リリース
//}
```

#### Tip（ヒント）
```review
//tip[パフォーマンス改善]{
インデックスを追加することで、クエリ速度が10倍向上します。
//}
```

#### Info（情報）
```review
//info[動作環境]{
* OS: Ubuntu 22.04 LTS
* Memory: 8GB以上推奨
* Storage: 20GB以上
//}
```

#### Warning（警告）
```review
//warning[データ削除に関する警告]{
この操作は取り消せません。必ずバックアップを取得してください。
//}
```

#### Important（重要）
```review
//important[緊急アップデート]{
セキュリティ脆弱性が発見されました。直ちにパッチを適用してください。
//}
```

#### Caution（注意）
```review
//caution[権限設定]{
管理者権限で実行する必要があります。設定を誤るとシステムが起動しなくなる可能性があります。
//}
```

#### Notice（お知らせ）
```review
//notice[メンテナンスのお知らせ]{
2024年4月1日 22:00-24:00 にメンテナンスを実施します。
//}
```

## アイコンの配置

アイコンファイルは以下の場所に配置してください：

```
プロジェクトルート/
├── img/
│   ├── memo.svg (or .png)
│   ├── tip.svg
│   ├── info.svg
│   ├── warning.svg
│   ├── important.svg
│   ├── caution.svg
│   └── notice.svg
```

### アイコンファイルの優先順位

1. SVG形式（`.svg`）- 推奨
2. PNG形式（`.png`）- フォールバック
3. テキストラベル - アイコンファイルが存在しない場合

## スタイリング

### HTML/ePub用CSS

各ブロックには専用のCSSクラスが適用されます：

```css
/* ノート */
.rs-note { ... }
.rs-note-title { ... }

/* ミニブロック */
.rs-memo { ... }
.rs-tip { ... }
.rs-info { ... }
.rs-warning { ... }
.rs-important { ... }
.rs-caution { ... }
.rs-notice { ... }
```

### カスタマイズ例

```css
/* 独自のスタイルを追加 */
.rs-warning {
  border: 2px solid #ff9800;
  background-color: #fff3e0;
}

.rs-warning::before {
  content: "⚠️ ";
  font-size: 1.5em;
}
```

## 前処理ツールの使用

`review-preprocess` コマンドで自動的にアイコン情報とCSSクラスが埋め込まれます：

```bash
# 前処理実行
$ node packages/review-macro-shims/bin/review-preprocess.js "**/*.re" -o .out

# 処理後のファイルでビルド
$ review-pdfmaker config.yml
```

## 制約事項

### ミニブロックの制約

- **参照不可**: ミニブロックにはラベルを付与できず、`@<note>{...}` での参照はできません
- **脚注**: LaTeX（PDF）出力時の制約により、ミニブロック内での脚注は非推奨です

### PDF出力時の注意

- アイコンは LaTeX の `\includegraphics` で挿入されます
- ページまたぎ: ノート内のコード・端末はページをまたぐことが可能
- ミニブロック内のコードはページまたぎ不可

## ベストプラクティス

### 1. 用途に応じた使い分け

- **参照が必要** → `//note` を使用
- **短い注意喚起** → ミニブロックを使用
- **種類別の視覚的区別** → 用途に応じたミニブロックを選択

### 2. タイトルの付け方

```review
// 良い例：具体的で簡潔
//warning[本番環境での注意]{...}

// 避けたい例：冗長
//warning[これは本番環境で実行する際の重要な注意事項です]{...}
```

### 3. 内容の構成

```review
//tip[効率的な書き方]{
// 1. 要点を最初に
キャッシュを使用すると3倍高速化します。

// 2. 詳細は箇条書きで
* Redis を使用
* TTL は 3600秒
* キー形式: user:{id}

// 3. 必要なら例を追加
//list[][実装例]{
cache.set("user:123", data, ttl=3600)
//}
//}
```

## トラブルシューティング

### Q: アイコンが表示されない

**A**: 以下を確認してください：
1. `img/` ディレクトリにアイコンファイルが存在するか
2. ファイル名が正しいか（`info.svg` など）
3. CSS で相対パスが正しく設定されているか

### Q: ノートの参照ができない

**A**: 第1引数のみ指定していませんか？ラベルを参照可能にするには、第1引数にラベル、第2引数にタイトルを指定してください。

```review
// ❌ 参照不可（第1引数はタイトルとして解釈）
//note[作業メモ]{...}

// ✅ 参照可能
//note[work-note][作業メモ]{...}
```

### Q: ミニブロック内でコードが表示されない

**A**: ミニブロック内でも `//list` は使用できますが、インデントに注意してください：

```review
//tip[コード例]{
正しくインデントされたコード：

//list[][サンプル]{
def hello():
    print("Hello")
//}
//}
```

## 関連リソース

- [Re:VIEW 公式ドキュメント - ノート](https://github.com/kmuto/review/blob/master/doc/format.ja.md#note)
- [list-migration.md](./list-migration.md) - リスト記法の移行ガイド
- [CSS スタイルガイド](../review-styles/README.md)